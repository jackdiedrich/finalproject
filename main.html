<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
	<head>
		<style type="text/css">
			* {font-family: Verdana}
			.axis path,
			.axis line {
				fill: none;
				stroke: black;
				shape-rendering: crispEdges;
			}
			.axis text {
				font-size: 11px;
			}
			circle {fill:rgba(0,0,0,0.3)}
			#speciesList{float:left}
			#plotDiv1{float:right}
			p {font-weight:normal;font-size:10px;}
			.speciesP {display:inline; margin-left:5px}
		</style>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
	</head>
	<body>
		<h1>Data Visualization</h2>
		<div id="speciesList">
			<div id="plotDiv1"></div>
		</div>
		<script>
			var dataset;
			var w = 500;
			var h = 500;
			var paddingSides = 30;
			var paddingBottom = 20
			var dAreaScale;
			
			 d3.select("#plotDiv1")
                	.append("svg")
                	.attr("width",w)
                	.attr("height",h);
			
			d3.csv("fakedata.csv", function(data) {
				dataset = data;
				
				console.log(d3.max(dataset,function(d){return d.sv}));
				
				svScale = d3.scale.linear()
					.domain([0,d3.max(dataset,function(d){return (d["sv"])})])
					.range([paddingSides,w]);
				dAreaScale = d3.scale.linear()
					.domain([d3.max(dataset,function(d){return d["d_area"]}),0])
					.range([paddingBottom,h-paddingBottom]);
				
				var xAxis = d3.svg.axis()
                  .scale(svScale)
                  .orient("bottom");
                d3.select("svg")
                	.append("g")
                	.attr("class","axis")
                	.attr("transform", "translate(0," + (h - paddingBottom) + ")")
                	.call(xAxis);
                var yAxis = d3.svg.axis()
                  .scale(dAreaScale)
                  .orient("left");
                d3.select("svg")
                	.append("g")
                	.attr("class","axis")
                	.attr("transform", "translate(" + paddingSides + ",0)")
                	.call(yAxis);
                writeHeadings();	
                writeNamesAll(dataset);
                drawCircles(dataset);
               	highlightCircle();
			});
			
			function writeHeadings(){
				var genera = ["A","B","C","D","E","F","G","H","I","J"]
				d3.select("#speciesList")
					.selectAll("h3")
					.data(genera)
					.enter()
					.append("h3")
					.attr("id",function(d){
						return d;
					})
					.text(function(d){
						return "Genus "+d;
					});
			}
			function writeNamesAll(dataset){
				writeNames(dataset,"A");
				writeNames(dataset,"B");
				writeNames(dataset,"C");
				writeNames(dataset,"D");
				writeNames(dataset,"E");
				writeNames(dataset,"F");
				writeNames(dataset,"G");
				writeNames(dataset,"H");
				writeNames(dataset,"I");
				writeNames(dataset,"J");
			}
			function writeNames(dataset,header){
				d3.select("#speciesList")
					.select("#"+header)
					.selectAll("p")
					.data(dataset)
					.enter()
					.append("p")
					.attr("class","speciesP")
					.attr("id",function(d){
						return d.taxon;
					})
					.text(function(d){
						return d.taxon;
					});
				d3.select("#speciesList")
					.select("#"+header)
					.selectAll("p")
					.filter(function(d){
						if (d.genus != header){
							return this;
						}
					})
					.remove();
			}
			function drawCircles(dataset){
				d3.select("#plotDiv1")
					.select("svg")
					.selectAll("circle")
					.data(dataset)
					.enter()
					.append("circle")
					.attr("id",function(d){
						return d.taxon;
					})
					.attr("r",5)
					.attr("cx",function(d){
						return svScale(d.sv);
					})
					.attr("cy",function(d){
						return dAreaScale(d.d_area);
					});
			}
			function highlightCircle(){
				d3.select("#speciesList")
					.selectAll("p")
					.on("mouseover",function(){
						var id = d3.select(this).attr("id");
						d3.select("#plotDiv1")
							.selectAll("circle")
							.style("fill",function(){
								if (d3.select(this).attr("id") == id){
									return "rgba(0,0,0,1)";
								}
								else {
									return "rgba(0,0,0,0.3)";
								}
							});
					});
					d3.select("#speciesList")
						.selectAll("p")
						.on("mouseout",function(){
							d3.select("#plotDiv1")
							.selectAll("circle")
							.style("fill","rgba(0,0,0,0.3)");
						});
			}
		</script>
	</body>
</html>